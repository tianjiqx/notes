# 指标

[TOC]

## 应用场景

指标异常标注

指标异常检测

- 单指标 （异常检测，离群值检测）

- 基于标准差生成的预测区间识别异常

- 多指标
  
  - xgboost 等分类算法
  
  - PyOD 多指标异常检测算法
    
    - 基于对多个指标计计算异常分数，然后根据异常分数阈值识别异常。

指标预测

- 容量规划 （预测）

指标根因分析

- 通过对整体指标的构成下钻，展示问题实例或者维度。阿里SLS根因分析函数

具体解释：

- 单指标异常波动检测：是指为了实现修复BUG、满足新特性、提升性能等需求，对软件进行升级、扩容、迁移或配置更新，导致KPI指标出现突然增大或降低这种剧烈波动，需要在系统中及时发现此类波动，以免影响其他算法产生错误结果。
- 单指标异常诊断：发现那些超出正常取值范围的数值点。与异常波动检测不同的是，异常诊断是在日常指标数值变化中找出异常数值点。此类异常在时间上并不连续，可能只在个别时刻发生，且在数值大小上与正常值相差不一定很大。
- 多指标异常诊断：是针对某类软件、系统、服务器、基站等事物的异常诊断，这类事物是由多个KPI指标组成。此问题又被称为N个事物M维指标T时刻的综合评价问题。与单指标异常诊断不同的是，**它是通过多个指标累计体现出的数值差异来反映事物的异常程度。** （单一的维度异常并不代表一定整体异常，整体异常，希望获知导致异常的核心问题指标）

## 指标根因分析

### 多维下钻

#### Adtributor

将多维根因分析问题分解为多个单维根因分析问题，分别针对**量值**与**率值**两类指标进行多维度的根因分析。

思路：

- 基于如ARIMA模型根据历史数据对一个测量值进行预测，并配置告警。

- 下钻分析，TODO

#### ImpAPTr

广度优先的多维下钻根因定位算法，相比与Adtributor 只分析单维度的影响，增加维度组合计算贡献度和差异度系数。

### 故障刻画

#### iSQUAD

iSQUAD 首先离线对历史上在间歇性慢速查询 iSQ 发生时的异常指标变化类型进行刻画，将不同种类的 iSQ 聚类为不同的类别。

在在线阶段，通过匹配故障特征相同的类别定位出根因的 iSQ , 并推荐历史的修复策略。

#### PatternMatcher

从大规模的生产系统中总结出 13 种典型的异常模式；

PatternMatcher采用双样本假设检验作为粗粒度的异常检测算法，筛选出在该事件发生时表现正常的指标。

利用 p-value 方法对每个指标计算得分并排序。

### 因果关系图

通过Metrics 之间的依赖关系构建出因果关系图，然后基于相关性或随机游走算法在图上游走从而定位出根因

#### Microscope

#### MicroRCA

#### MicroHECL

思路：

- 首先根据根据最近30分钟的服务调用关系构造出服务依赖图

- 通过划分三个异常类型，构建出不同异常类型的的传播图
  
  - 性能故障： OC-SVM 响应延迟特征，故障传播从下游传播到上游
  
  - 可靠性故障：用随机森林以请求错误率的特征，故障传播从下游传播到上游
  
  - 流量异常故障：3-sigma 规则检测 QPS 的波动，故障传播从上游传播到下游

- 最后根据异常传播图找到最深的节点作为根因

## REF

- [智能运维之道](https://weread.qq.com/web/bookDetail/a75328f0813ab6da3g01279f)
- 基于metrics的根因定位 (论文survey，推荐)
  - [基于 Metrics 的根因定位 (一)：故障刻画](https://mp.weixin.qq.com/s?__biz=MzI5Mjc1NTcwNA==&mid=2247483712&idx=1&sn=f5d85933ccfab91d854bdeb03eefec2e)
  - [基于 Metrics 的根因定位 (二)：因果关系图](https://mp.weixin.qq.com/s?__biz=MzI5Mjc1NTcwNA==&mid=2247483734&idx=1&sn=0443ed6cbe13e5bf6d557186cf6edd56)
  - [基于 Metrics 的根因定位 (三)：多维下钻](https://mp.weixin.qq.com/s?__biz=MzI5Mjc1NTcwNA==&mid=2247483788&idx=1&sn=a934d21a2b505578d98a72c497d6be44)
