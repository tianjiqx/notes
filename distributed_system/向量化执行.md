# 向量化执行

## 1. 概念



## 2. 原理



## 3.实现





## REF





扩展材料：

- [十分钟成为 Contributor 系列 | TiDB 向量化表达式活动第二弹](https://zhuanlan.zhihu.com/p/85553472) 
- [[面向guard编程系列] 2. 一元guard的使用： 一个避免静态代码爆炸的C++ idiom，用于OLAP向量化执行引擎的开发](https://zhuanlan.zhihu.com/p/338241036) 
- [数据库计算引擎的优化技术：向量化执行与代码生成](https://zhuanlan.zhihu.com/p/100933389) 
- [PolarDB-X 向量化引擎的类型绑定与代码生成](https://zhuanlan.zhihu.com/p/357520668) 
- [每次都需要解释大量指令？使用 PolarDB-X 向量化引擎](https://zhuanlan.zhihu.com/p/354572485) 
- [十分钟成为 Contributor 系列 | TiDB 向量化表达式活动第二弹](https://zhuanlan.zhihu.com/p/85553472) 
- [[面向guard编程系列] 2. 一元guard的使用： 一个避免静态代码爆炸的C++ idiom，用于OLAP向量化执行引擎的开发](https://zhuanlan.zhihu.com/p/338241036) 
- [数据库计算引擎的优化技术：向量化执行与代码生成](https://zhuanlan.zhihu.com/p/100933389)
- [PolarDB-X 向量化引擎的类型绑定与代码生成](https://zhuanlan.zhihu.com/p/357520668)
- [cockroachdb:how-we-built-a-vectorized-execution-engine](https://www.cockroachlabs.com/blog/how-we-built-a-vectorized-execution-engine/)
  - 底层存储是kv，非列式，OLTP数据库
  - 在磁盘读取行后，转换为批的列存数据格式，再输入到向量化执行引擎
  - 使用代码生成来减轻向量化执行引擎的维护负担
    - 向量化执行后，分析性能瓶颈在类型转换，类型断言开销上，因此改进是通过代码生成具体类型（不手写重复代码，使用模板，go不支持泛型），提升2倍。（代码量膨胀。rust零成本抽象呢，编译后，知道使用具体的类型，某些方面可能更容易达到高性能，而无需代码生成？宏？）
    - 批处理+模板化代码，比原来提升5.5
    - 进一步优化，多层循环，更改循环顺序，影响
      - 分支预测
      - 流水线
    - 最终提升20倍。基准测试cpu时间提升70倍，tpch测试提升4倍（磁盘时间占比最大，降低了整体的加速比）
  - (该文章包含golang pprof 分析过程)

- [slides: Vectorized Query Execution in Apache Spark at Facebook](https://databricks.com/session/vectorized-query-execution-in-apache-spark-at-facebook) 2019



论文：

- [MonetDB/X100: Hyper-Pipelining Query Execution](http://cidrdb.org/cidr2005/papers/P19.pdf)
- [Vectorization vs. Compilation in Query Execution](https://15721.courses.cs.cmu.edu/spring2016/papers/p5-sompolski.pdf)
- [Everything You Always Wanted to Know About Compiled and Vectorized Queries But Were Afraid to Ask](https://www.vldb.org/pvldb/vol11/p2209-kersten.pdf)



相关课程：

- [MIT 6.172: Performance Engineering of Software Systems (Fall 2018)](https://ocw.mit.edu/courses/electrical-engineering-and-computer-science/6-172-performance-engineering-of-software-systems-fall-2018)
  - [【MIT公开课】6.172 软件性能工程 · 2018年秋](https://www.bilibili.com/video/BV1wA411h7N7/) B站



