
## 单元测试（unint testing）

### 概念
> 单元测试又称为模块测试, 是针对程序模块（软件设计的最小单位）来进行正确性检验的测试工作。程序单元是应用的最小可测试部件。在过程化编程中，一个单元就是单个程序、函数、过程等；对于面向对象编程，最小单元就是方法，包括基类（超类）、抽象类、或者派生类（子类）中的方法。
> 每个理想的测试案例独立于其它案例；为测试时隔离模块，经常使用stubs、mock或fake等测试马甲程序。
> -- wikipedia

### 好处
- 证明这些隔离的单个部件是正确，无需开发人员在分析bug的时候，重复分析这些单元本身是否存在问题,**节约时间**。
- 通过考虑边界等各种情况，可以提前发现bug，保证代码质量。
- 适应变更，允许在未来重构代码，并且确保模块依然工作正确（复合测试），一旦变更发现错误，能够通过单元测试，定位bug，并修复。**良好设计的单元测试案例覆盖程序单元分支和循环条件的所有路径。**
- 简化集成测试，单元测试消除了单元的不确定性，通过自底向上的单元模块测试，再完成构建部件的测试更加简单。
- 文档手册，单元测试也是一份**API使用手册**，供其他人员，方便理解和参考API的使用。

### 如何写单元测试
- 保持测试小和快
- 自动化，无须交互，一键运行
- 针对测试对象为最小的函数、方法单元
- 每个测试单元完全独立，不应依赖
- 命名规范，使测试框架发现测试用例，如junit，测试类TestXXX，测试方法testXXX(),其他框架按对应的风格编写
- 对public的方法、函数进行测试，不测试私有的方法，函数，便于维护
- 保证测试覆盖率，尽量覆盖到所有的代码和分支
- 覆盖到边界值
- 使用随机数生成器生成参数，迭代多次
- 每个测试用例的功能应该单一，使其易用维护
- 提供详细的错误信息，assertEqals()优与assertTrue()
- 考虑异常测试，破坏性输入，应也能按预期的处理
- 编写和维护单元测试的成本很高，可以通过如下方法降低成本
  - 关注重要的方法
  - 使用不可变成员
  - 通过使用友元（C++）、内部作用域（C#）和包范围（Java）减少公有API
  - 减少不必要的分支
  - 使用exception和assertion检验参数
  - 限制方法参数，fun1(x,x){ fun(x,x,x,x) } 替代fun(x,x,x,x){}
- 使用mock替换外部依赖
- trade-off编写多详细的单元测试
- 处理测试失败，必要空指针等问题导致程序停止，无法运行其他单元测试
- 为发现的bug编写单元测试
- 测试用例同样应该使用版本控制，对于代码的版本 




### 单元测试框架
- junit (for java、scala)
- gtest (for c++)

### 参考资料
- [wiki单元测试](https://zh.wikipedia.org/wiki/%E5%8D%95%E5%85%83%E6%B5%8B%E8%AF%95)
- [wiki unit testing](https://en.wikipedia.org/wiki/Unit_testing)
- [单元测试指南](https://petroware.no/unittesting.html) 
- [google软件测试之道](https://pan.baidu.com/s/1dDgUSpz)  
